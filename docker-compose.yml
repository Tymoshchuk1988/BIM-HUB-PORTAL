services:
  web:
    build: 
      context: .
      dockerfile: Dockerfile
    container_name: bimhub-portal-web
    ports:
      - "8080:80"
    volumes:
      - ./public_html:/var/www/html
      - ./src:/var/www/src
      - ./config:/var/www/config
      - ./bin:/var/www/bin
      - ./storage:/var/www/storage
    environment:
      - DB_HOST=db
      - DB_PORT=5432
      - DB_DATABASE=bimhub_portal
      - DB_USERNAME=bimhub_portal
      - DB_PASSWORD=bimhub_portal_pass
    depends_on:
      db:
        condition: service_healthy

  db:
    image: postgres:15-alpine
    container_name: bimhub-portal-db
    restart: always
    ports:
      - "5434:5432"  # Змінюємо порт на 5434
    environment:
      - POSTGRES_DB=bimhub_portal
      - POSTGRES_USER=bimhub_portal
      - POSTGRES_PASSWORD=bimhub_portal_pass
    volumes:
      - postgres_data_portal:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U bimhub_portal"]
      interval: 10s
      timeout: 5s
      retries: 5

  adminer:
    image: adminer
    container_name: bimhub-portal-adminer
    restart: always
    ports:
      - "8082:8080"  # Змінюємо порт на 8082
    depends_on:
      db:
        condition: service_healthy

volumes:
  postgres_data_portal:
